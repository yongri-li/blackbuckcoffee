{% capture function %}
  {% comment note:
    Shopify, crazily enough, does not have a global object that returns the current url like it does for the page_title.
    So lets fake one.
    It will take into account filtered collections.
    It will not take into account url params and hash anchors, because reasons.
    page_url_with_shop_domain gives you the page_url with the shop.url prepended.
   %}{% endcomment %}

  {% if template contains '404' %}
    {% assign page_url = '/404' %}
  {% elsif template contains 'article' %}
    {% assign page_url = article.url %}
  {% elsif template contains 'blog' %}
    {% assign page_url = blog.url %}
  {% elsif template contains 'cart' %}
    {% assign page_url = '/cart' %}
  {% elsif template contains 'list-collections' %}
    {% assign page_url = '/collections' %}
  {% elsif template contains 'collection' %}
    {% if collection.url != blank %}
      {% assign page_url = collection.url %}
    {% else %}
      {% assign page_url = '/collections/all' %}
    {% endif %}
    {% if current_tags.size > 0 %}
      {% capture current_tag_params %}{% endcapture %}
      {% for current_tag in current_tags %}
        {% capture current_tag_params %}{{ current_tag_params }}{% unless forloop.first %}+{% endunless %}{{ current_tag | handle }}{% endcapture %}
      {% endfor %}
      {% assign page_url = page_url | append: '/' | append: current_tag_params %}
    {% endif %}
  {% elsif template contains 'index' %}
    {% assign page_url = '/' %}
  {% elsif template contains 'page' %}
    {% assign page_url = page.url %}
  {% elsif template contains 'product' %}
    {% assign page_url = product.url %}
  {% elsif template contains 'search' %}
    {% assign page_url = '/search' %}
  {% elsif template contains 'customers' %}
    {% if template contains 'activate_account' %}
      {% assign page_url = '/account/activate' %}
    {% elsif template contains 'account' %}
      {% assign page_url = '/account' %}
    {% elsif template contains 'addresses' %}
      {% assign page_url = '/account/addresses' %}
    {% elsif template contains 'login' %}
      {% assign page_url = '/account/login' %}
    {% elsif template contains 'order' %}
      {% if order != blank %}
        {% assign page_url = order.customer_url | remove: shop.url %}
      {% else %}
        {% assign page_url = '/account/orders' %}
      {% endif %}
    {% elsif template contains 'register' %}
      {% assign page_url = '/account/register' %}
    {% elsif template contains 'reset' %}
      {% assign page_url = '/account/reset' %}
    {% else %}
      {% assign page_url = null %}
    {% endif %}
  {% else %}
    {% assign page_url = null %}
  {% endif %}

  {% if page_url != null %}
    {% assign page_url_with_shop_domain = page_url | prepend: shop.url %}
  {% endif %}
{% endcapture %}

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0ZC9W6N2QH" defer></script>
<script defer>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-0ZC9W6N2QH');
</script>

<script>
  gtag('event', 'page_view', {
    'send_to': 'G-0ZC9W6N2QH',
    'page_title': '{{ page_title }}',
    'page_path': '{{ page_url }}'
  });
</script>


{% if template contains 'product' or template contains 'collection' or template contains 'index' or template contains 'search' or template contains 'cart' %}
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-645767905"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'AW-645767905', {'send_page_view': false, 'custom_map': {'dimension1': 'Product SKU', 'dimension2': 'ecomm_pagetype', 'dimension3': 'ecomm_totalvalue'}});
gtag('config', 'AW-645767905');
</script>

<script>
gtag('event', 'page_view', {
'ecomm_pagetype': {% if template contains 'collection' %}category{% elsif template contains 'search' %}searchresults{% elsif template contains 'product' %}product{% elsif template contains 'cart' %}cart{% elsif template contains 'index' %}home{% endif %},
{% if template contains 'product' %}
'Product SKU': 'shopify_IN_{{ product.id }}_{% if product.variants.first.id %}{{ product.variants.first.id }},{% else %}{{ product.variants.id }}{% endif %}',
'ecomm_totalvalue': {{ product.price_min | money_without_currency | replace: ',', '.' }},
{% elsif template contains 'cart' %}
'ecomm_prodid': [{% for item in cart.items %}'shopify_US_{{ item.product_id }}_{{ item.variant_id }}'{% unless forloop.last %},{% endunless %}{% endfor %}],
'ecomm_totalvalue': {{ cart.total_price | money_without_currency | replace: ',', '.' }},
{% endif %}
'non_interaction': true
});
</script>
{% endif %}
